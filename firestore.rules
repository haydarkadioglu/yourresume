rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    match /resumes/{userId} {
      // Allow users to create and update their own resume
      allow create, update: if request.auth.uid == userId;

      // Allow anyone to read a resume if it has a username
      allow read: if resource.data.personalInfo.username != null;

      match /loginHistory/{historyId} {
        // Allow users to create their own login history entries
        allow create: if request.auth.uid == userId;

        // Allow users to read their own login history
        allow read: if request.auth.uid == userId;

        // Nobody can update login history for audit purposes
        allow update: if false;
        
        // Allow user to delete their own old login history entries for cleanup
        allow delete: if request.auth.uid == userId;
      }
    }
  }
}
